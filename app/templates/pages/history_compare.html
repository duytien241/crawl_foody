{% extends "pages/base.html" %}
{% load static %}
{% block title %}Lịch sử quét và so sánh{% endblock  %}
{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/changes.css' %}">
{% endblock %}
{% block active%}
<div class="my-2 my-sm-0 mr-3 " href='#'>
    <img src="" alt="" class="avatar mr-2">
    <div class="dropdown d-inline-block ">
        <a class="btn btn-outline-success dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Welcome {{user.last_name}}
        </a>

        <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
            <a class="dropdown-item" href="#">Profile</a>
            <a class="dropdown-item" href = "{%url 'logout'%}">Logout</a>
        </div>
    </div>
</div>

{%endblock%}
{% block navbar %}
{% if not user.username %}
<br><br><br><br><br><br><br><br><br><br><br><br>
<h1>Đang được xây dựng</h1>
{% else %}
<div class="d-flex mt-4" id="wrapper">
    <div class="bg-light border-right"  id="sidebar-wrapper">
            <div class="list-group list-group-flush" id="overlay">
                <a href="#" class="list-group-item list-group-item-action bg-light mt-2"><i
                        class="far fa-bell mr-3"></i>Notifications</a>
                <a href="/websites" class="list-group-item list-group-item-action bg-light"><i
                        class="far fa-file-alt mr-3"></i>Websites</a>
                <a href="/manageaddress" class="list-group-item list-group-item-action bg-info active"><i class="fas fa-address-book mr-3"></i>Kênh thông báo</a>
            </div>
    </div>
{% endif %}
{% endblock navbar %}
{% block content %}
<div class="container mt-4">
    <h3>Lịch sử so sánh của : <a href="{{data.0.uri_id.uri}}">{{DataCompare.0.uri_id.name}}</a></h3>
    <div class = "row d-flex justify-content-left">
        <form class ="col-xl-4 form-group mt-3">
            <input class="form-control" type="datetime-local" value="2000-01-01T01:00:00" id="example-datetime-local-input">
        </form>
        <form class ="col-xl-6 form-group mt-3">
            <button class="btn btn-outline-info btn-rounded btn-sm my-0 py-1 px-3 mt-1" type="submit">Search</button>
        </form>
    </div>
    <div class="row">
    {% for object in DataCompare  %}
        <div class="col-xl-12">
            <hr/>
        </div>
        <div class="col-xl-6 col-sm-6 mt-3">
            <div class="text-info block mt-5">Thời gian quét: <span class ="text-dark font-weight-bold">{{object.timeCrawl}}</span>{% if object.original_data  %} <i class="text-danger fas fa-star" id ="{{object.id}}"></i>{% else %}<i class="text-secondary fas fa-star" id ="{{object.id}}"" onclick="ChangeOriginalData(this.id)"></i>{% endif %}</div>
            <div class="text-info block">Tiêu đề: <span class ="text-dark">"{{object.title}}"</span></div>
            <div class="text-info block">Status: <span class ="text-dark">{{object.status}}</span></div>
            <div class="text-info block">Chiều dài trang: <span class ="text-dark">"{{object.pageHeight}}px"</span></div>
            <div class="text-info block">Chế độ xem: <span class ="text-dark"> "1366:1366"</span></div>
            {% if object.similar_percentages > 0 %}
                <div class="text-info block">Độ thay đổi: <span class ="text-dark">{{object.similar_percentages}} %   </span></div>
                <div class ="mt-3">Chi tiết so sánh với phiên bản:<span class="text-danger"> {{ object.data_old}}</span></div>
                <ul>
                <li><a href ="/changes/{{object.id}}?active=1">Mã nguồn</a></li>
                <li><a href ="/changes/{{object.id}}?active=2">Text</a></li>
                <li><a href ="/changes/{{object.id}}?active=3">Điều hướng</a></li>
                <li><a href ="/changes/{{object.id}}?active=4">Ảnh chụp màn hình</a></li>
                </ul>
            {% endif %}
        </div>
        <div class="col-xl-6 col-sm-6 crop mt-3 text-center">
            <img class ="mt-5 border"  src="{% static object.imageScreenShot %}"/>
        </div>
        <hr />
    {% endfor %}
    {% if DataCompare.has_other_pages %}
        <div class =" col-lg-12 d-flex justify-content-center mr-5 mt-5 mb-5">
        <ul class="pagination">
        {% if DataCompare.has_previous %}
            <li class ="page-item" ><a  class="page-link" href="?page={{ DataCompare.previous_page_number }}=">&laquo;</a></li>
        {% else %}
            <li class=" page-item disabled"><span class="page-link">&laquo;</span></li>
            {% endif %}
            {% for i in DataCompare.paginator.page_range %}
            {% if DataCompare.number == i %}
            <li class=" page-item active"><span  class="page-link">{{ i }} <span class="sr-only">(current)</span></span></li>
            {% else %}
            <li class ="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
            {% endif %}
            {% endfor %}
            {% if DataCompare.has_next %}
            <li class ="page-item"><a class="page-link" href="?page={{ DataCompare.next_page_number }}">&raquo;</a></li>
            {% else %}
            <li class=" page-item disabled"><span class="page-link">&raquo;</span></li>
            {% endif %}
        </ul>
        </div>
    {% endif %}
    </div>
    </div>
</div>
</div>
{% endblock %}
{% block script %}
<script>
$( window ).resize(function() {
    if ($(window).width() <= 768){
        $('#overlay').addClass('overlay')
    }
    else{
       document.getElementsByClassName("overlay")[0].style.display = "block";
        $('#overlay').removeClass('overlay')
    }
    });
$(document).ready( function(){
    if ($(window).width() <= 768){
        $('#overlay').addClass('overlay')
    }
    else{
        
        $('#overlay').removeClass('overlay')
    }
    $('.overlay').click(function(){
        document.getElementsByClassName("overlay")[0].style.display = "none";
    });
     $("#menu-toggle").click(function(e) {
      e.preventDefault();
      if ($(window).width() <= 768){
        if($('.overlay').css('display') == 'none'){
            $('.overlay').show();
        }
        else{
            $('.overlay').hide();
        }
      }
    });
});
    function ChangeOriginalData(id){
        var url = $(location).attr('href')
        var data_current = url.substring(url.lastIndexOf('/') + 1);
        Swal.fire({
        title: 'Cảnh báo!!',
        type: 'warning',
        html: "Đặt dữ liệu này làm dữ liệu gốc so sánh?.",
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Chấp nhận',
        cancelButtonText: 'Hủy'
    }).then((result) => {
        if (result.value) {
            $.ajax({
            url:'/historycompare/'+data_current,
            type: 'get',
		    dataType: 'json',
            data: {"id":id},
            success: function(data){
                Swal.fire(
                'Cập nhật thành công!',
                'Dữ liệu đã được đặt làm dữ liệu gốc so sánh!',
                'success'
                ).then(()=>{
                   location.reload();
                });
            }
        });
        }
    });
        
    }
</script>
{% endblock script %}   